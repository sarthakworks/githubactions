name: Code gemini

on:
  pull_request:
    branches: [main, develop]

jobs:
  code_review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20 # Or your preferred version (18, 20, or 21)

      - name: Clear npm cache
        run: npm cache clean --force

      - name: Install dependencies
        run: npm install # Installs from package.json (including eslint)

      - name: Run linters (javascript)
        run: npx eslint . > eslint_results.txt # Use npx!

      - name: Post results as comment (javascript)
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs').promises;
            let results = "";

            try { results += "## ESLint Results\n\n\`\`\`\n" + await fs.readFile('eslint_results.txt', 'utf8') + "\n\`\`\`\n\n"; } catch (e) {}

            if (results) { // Only post if there are results to avoid empty comments
              return github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: results
              });
            }